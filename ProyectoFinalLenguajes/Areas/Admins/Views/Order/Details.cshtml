@model ProyectoFinalLenguajes.Models.Order

@{
    ViewData["Title"] = "Detalles de la Orden";
}

<div class="border p-3 mt-4">
    <div class="row pb-2">
        <h2 class="text-primary">Detalles de la Orden #@Model.Id</h2>
        <hr />
    </div>

    @* --- Información General de la Orden --- *@
    <div class="mb-3">
        <label class="form-label text-secondary">ID de la Orden:</label>
        <p class="form-control-plaintext">@Model.Id</p>
    </div>

    <div class="mb-3">
        <label class="form-label text-secondary">Fecha de la Orden:</label>
        <p class="form-control-plaintext">@Model.Date.ToString("dd/MM/yyyy HH:mm")</p>
    </div>

    <div class="mb-3">
        <label class="form-label text-secondary">Estado:</label>
        <p class="form-control-plaintext">
            <span class="badge @(Model.Status == "Completada" ? "bg-success" : Model.Status == "Pendiente" ? "bg-warning text-dark" : "bg-info")">
                @Model.Status
            </span>
        </p>
    </div>

    <hr class="my-4" /> @* Separador para la sección de cliente *@

    @* --- Información del Cliente --- *@
    <h3 class="text-primary mb-3">Información del Cliente</h3>
    @if (Model.Customer != null)
    {
        <div class="mb-3">
            <label class="form-label">Nombre del Cliente:</label>
            <p class="form-control-plaintext">@Model.Customer.FirstName @Model.Customer.LastName</p>
        </div>

        <div class="mb-3">
            <label class="form-label">Email del Cliente:</label>
            <p class="form-control-plaintext">@Model.Customer.Email</p>
        </div>

        <div class="mb-3">
            <label class="form-label">Teléfono del Cliente:</label>
            <p class="form-control-plaintext">@(string.IsNullOrEmpty(Model.Customer.PhoneNumber) ? "N/A" : Model.Customer.PhoneNumber)</p>
        </div>
    }
    else
    {
        <p class="text-muted mb-3">Información del cliente no disponible.</p>
    }

    <hr class="my-4" /> @* Separador para la sección de platos *@

    @* --- Platos en la Orden --- *@
    <h3 class="text-primary mb-3">Platos de la Orden</h3>
    @if (Model.OrderDishes != null && Model.OrderDishes.Any())
    {
        <table class="table table-bordered table-striped table-hover mb-4">
            <thead class="bg-light">
                <tr>
                    <th>Plato</th>
                    <th>Cantidad</th>
                    <th>Precio Unitario</th>
                    <th>Subtotal</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model.OrderDishes)
                {
                    <tr>
                        <td>@(item.Dish?.Name ?? "Plato Desconocido")</td>
                        <td>@item.Quantity</td>
                        <td>@((item.Dish?.Price ?? 0).ToString("C", new System.Globalization.CultureInfo("es-CR")))</td>
                        <td>@((item.Quantity * (item.Dish?.Price ?? 0)).ToString("C", new System.Globalization.CultureInfo("es-CR")))</td>
                    </tr>
                }
            </tbody>
            <tfoot>
                <tr>
                    <th colspan="3" class="text-end">Total de la Orden:</th>
                    <th>
                        @{
                            var totalOrder = Model.OrderDishes.Sum(od => od.Quantity * (od.Dish?.Price ?? 0));
                        }
                        @totalOrder.ToString("C", new System.Globalization.CultureInfo("es-CR"))
                    </th>
                </tr>
            </tfoot>
        </table>
    }
    else
    {
        <p class="text-muted">No hay platos asociados a esta orden.</p>
    }
</div>
